<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è¨˜äº‹ | ã©ã†ãƒ™ãƒ“</title>
  <meta name="description" content="ã©ã†ãƒ™ãƒ“å…¬å¼ã®è¨˜äº‹ãƒšãƒ¼ã‚¸ã€‚ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ãŠçŸ¥ã‚‰ã›ãƒ»ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ãªã©ã€‚">
  <link rel="icon" href="../assets/img/favicon.svg" type="image/svg+xml">

  <!-- OGPï¼ˆé™çš„ãªå…±é€šå€¤ã€‚å³å¯†ãª per-article OGP ã¯å°†æ¥SSRã§å¯¾å¿œï¼‰ -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="è¨˜äº‹ | ã©ã†ãƒ™ãƒ“">
  <meta property="og:image" content="https://babyanimals.pages.dev/assets/img/og.png">
  <meta property="og:url" content="https://babyanimals.pages.dev/news/">

  <!-- Cloudflare Pages å…±é€šCSS/JSï¼ˆç›¸å¯¾ãƒ‘ã‚¹ã¯ /news/ ã‹ã‚‰ã®å‚ç…§ï¼‰ -->
  <link rel="stylesheet" href="../assets/css/style.css" />
  
  <!-- Supabaseï¼ˆãƒ¡ã‚¿çµŒç”±ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ -->
  <meta name="supabase-url" content="https://hvhpfrksyytthupboaeo.supabase.co">
  <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2aHBmcmtzeXl0dGh1cGJvYWVvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTc4MzQsImV4cCI6MjA3MjYzMzgzNH0.e5w3uSzajTHYdbtbVGDVFmQxcwe5HkyKSoVM7tMmKaY">

  <!-- Cloudflare Web Analyticsï¼ˆæ—¢å­˜ã®ãƒˆãƒ¼ã‚¯ãƒ³ã«å·®ã—æ›¿ãˆæ¸ˆã¿æƒ³å®šï¼‰ -->
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
          data-cf-beacon='{"token":"5b85d28b47c74f79b6ad1c1f19c0a758"}'></script>

  <!-- canonical ã¯ JS ã§ slug å–å¾—å¾Œã«å·®ã—æ›¿ãˆï¼ˆé™çš„ã«ã¯ä¸€è¦§ã«å‘ã‘ã‚‹ï¼‰ -->
  <link id="canonical" rel="canonical" href="https://babyanimals.pages.dev/news/">

  <!-- ãƒšãƒ¼ã‚¸å†…ã ã‘ã®è»½ã„ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£è£œåŠ© -->
  <style>
    .article { max-width: 880px; margin: 0 auto; }
    .article-head { display:grid; gap:10px; margin: 8px 0 14px; }
    .article-title { font-size: clamp(20px, 5.5vw, 28px); line-height: 1.35; letter-spacing: .02em; margin: 0; }
    .article-meta { color:#73656a; font-size:13px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .article-cover { width:100%; aspect-ratio: 16/9; border-radius:16px; overflow:hidden; background:#f6f6f6; margin: 12px 0 16px; }
    .article-cover > img { width:100%; height:100%; object-fit:cover; display:block; }
    .article-body { font-size:16px; line-height:1.9; }
    .article-body h2, .article-body h3 { margin: 1.8em 0 .6em; }
    .article-body img { max-width:100%; height:auto; border-radius:12px; }
    .backline { display:inline-flex; align-items:center; gap:8px; color:#7a2460; text-decoration:none; font-weight:800; margin: 12px 0 16px; }
  </style>
</head>
<body class="theme">

  <!-- Headerï¼ˆCandy Ã— Emojiï¼‰ -->
  <header class="site-header site-header--candy">
    <div class="site-header__left">
      <a class="brand" href="../index.html" aria-label="ãƒ›ãƒ¼ãƒ ã¸">
        <span class="brand__emoji" aria-hidden="true">ğŸ¾</span>
        <svg class="brand__icon" aria-hidden="true" focusable="false">
          <use href="../assets/icons/icons.svg#icon-logo"></use>
        </svg>
        <span class="brand__title">ã©ã†ãƒ™ãƒ“</span>
      </a>
    </div>
    <div class="site-header__right">
      <button class="pill-btn like-btn" aria-label="ãŠæ°—ã«å…¥ã‚Š" aria-pressed="false" title="ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²">
        <span class="emoji-icon" aria-hidden="true">ğŸ’—</span>
      </button>
      <button class="pill-btn search-btn" aria-label="æ¤œç´¢" title="æ¤œç´¢">
        <span class="emoji-icon" aria-hidden="true">ğŸ”</span>
      </button>
      <button class="pill-btn bell-btn" aria-label="ãŠçŸ¥ã‚‰ã›" title="ãŠçŸ¥ã‚‰ã›">
        <span class="emoji-icon" aria-hidden="true">ğŸ””</span>
        <span class="badge" aria-hidden="true">!</span>
      </button>
    </div>
  </header>

  <!-- Tabbarï¼ˆPC/SPã¨ã‚‚ã‚¹ã‚¿ãƒƒã‚¯ï¼‹çµµæ–‡å­—ï¼‰ -->
  <nav class="tabbar tabbar--stack" aria-label="ãƒ¡ã‚¤ãƒ³">
    <a class="tabbar__link" href="../index.html" title="ãƒ›ãƒ¼ãƒ "><span class="tab-emoji" aria-hidden="true">ğŸ </span><span class="tabbar__text">ãƒ›ãƒ¼ãƒ </span></a>
    <a class="tabbar__link is-active" href="./index.html" aria-current="page" title="ãƒ‹ãƒ¥ãƒ¼ã‚¹"><span class="tab-emoji" aria-hidden="true">ğŸ“°</span><span class="tabbar__text">ãƒ‹ãƒ¥ãƒ¼ã‚¹</span></a>
    <a class="tabbar__link" href="../babies/index.html" title="èµ¤ã¡ã‚ƒã‚“"><span class="tab-emoji" aria-hidden="true">ğŸ¼</span><span class="tabbar__text">èµ¤ã¡ã‚ƒã‚“</span></a>
    <a class="tabbar__link" href="../calendar/index.html" title="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"><span class="tab-emoji" aria-hidden="true">ğŸ“…</span><span class="tabbar__text">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</span></a>
  </nav>

  <main class="container" id="main">
    <a class="backline" href="./index.html">â† ãƒ‹ãƒ¥ãƒ¼ã‚¹ä¸€è¦§ã«æˆ»ã‚‹</a>

    <article class="card card--panel article" itemscope itemtype="https://schema.org/Article">
      <header class="article-head">
        <h1 id="title" class="article-title" itemprop="headline">â€”</h1>
        <div class="article-meta">
          <time id="date" itemprop="datePublished" datetime=""></time>
          <span id="author" itemprop="author">ç·¨é›†éƒ¨</span>
          <span id="readtime"></span>
        </div>
      </header>

      <div id="cover" class="article-cover" hidden aria-hidden="true">
        <img id="cover-img" alt="" itemprop="image">
      </div>

      <div id="body" class="article-body" itemprop="articleBody">
        èª­ã¿è¾¼ã¿ä¸­â€¦
      </div>
    </article>
  </main>

  <footer class="site-footer" aria-label="ãƒ•ãƒƒã‚¿ãƒ¼">
    <small>Â© ã©ã†ãƒ™ãƒ“ï¼ˆå‹•ç‰©åœ’ãƒ™ãƒ“ãƒ¼æƒ…å ±ï¼‰</small>
  </footer>

  <!-- å…±é€šJSï¼ˆã‚¿ãƒ–ãƒãƒ¼ã®ç¾åœ¨åœ°ãƒã‚¤ãƒ©ã‚¤ãƒˆç­‰ï¼‰ -->
  <script src="../assets/js/app.js" defer></script>

  <!-- è¨˜äº‹å–å¾—ï¼†æç”» -->
  <script>
(function(){
  const fmtDate = (iso) => {
    if(!iso) return '';
    const d = new Date(iso);
    if(Number.isNaN(d.getTime())) return '';
    return d.toLocaleDateString('ja-JP', { year:'numeric', month:'long', day:'numeric' });
  };
  function getSlug(){
    const u = new window.URL(location.href);
    const q = (u.searchParams.get('slug')||'').trim();
    if(q) return q;
    const m = u.pathname.match(/\/news\/([^\/?#]+)/);
    return m ? decodeURIComponent(m[1]) : '';
  }
  function getSupabaseEnv(){
    const metaUrl = document.querySelector('meta[name="supabase-url"]')?.content?.trim();
    const metaKey = document.querySelector('meta[name="supabase-anon-key"]')?.content?.trim();
    return {
      URL:  (window.SUPABASE && (window.SUPABASE.URL  || window.SUPABASE.SUPABASE_URL))  || metaUrl,
      ANON: (window.SUPABASE && (window.SUPABASE.ANON || window.SUPABASE.SUPABASE_ANON_KEY)) || metaKey
    };
  }
  async function fetchJSON(url, headers){
    const res = await fetch(url, { headers, cache:'no-store' });
    if(!res.ok){
      const t = await res.text().catch(()=> '');
      throw new Error(`HTTP ${res.status} :: ${t}`);
    }
    return res.json();
  }
  async function fetchArticleBySlug(slug){
    const { URL: SUPA_URL, ANON } = getSupabaseEnv();
    if(!SUPA_URL || !ANON) throw new Error('Supabase URL / ANON KEY ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
    const headers = { apikey: ANON, Authorization: `Bearer ${ANON}` };

    const tryFetch = async (table, select) => {
      const u = new window.URL(`${SUPA_URL}/rest/v1/${table}`);
      u.searchParams.set('select', select);
      u.searchParams.set('slug', `eq.${slug}`);
      u.searchParams.set('status', 'eq.published');
      const arr = await fetchJSON(u.toString(), headers);
      return Array.isArray(arr) ? arr[0] : null;
    };

    let row = await tryFetch('article',  'slug,title,body_html,thumbnail_url,author_name,canonical_url,reading_time,published_at');
    if(row) return normalize(row);

    row = await tryFetch('articles', 'slug,title,body_html,thumbnail_url,author_name,canonical_url,reading_time,published_at');
    if(row) return normalize(row);

    row = await tryFetch('articles', 'slug,title,body_html,cover_url,author,published_at');
    if(row){
      row.thumbnail_url = row.thumbnail_url || row.cover_url || '';
      row.author_name   = row.author_name   || row.author || '';
      return normalize(row);
    }
    throw new Error('è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
  }
  function normalize(r){
    return {
      slug: r.slug,
      title: r.title || '',
      html:  r.body_html || '',
      cover: r.thumbnail_url || '',
      author: r.author_name || 'ç·¨é›†éƒ¨',
      canonical: r.canonical_url || '',
      readtime: r.reading_time || '',
      published_at: r.published_at || ''
    };
  }
  function render(a){
    document.getElementById('title').textContent = a.title || 'ï¼ˆç„¡é¡Œï¼‰';
    const t = fmtDate(a.published_at);
    const $date = document.getElementById('date');
    $date.textContent = t;
    if(a.published_at) $date.setAttribute('datetime', a.published_at);
    document.getElementById('author').textContent = a.author || 'ç·¨é›†éƒ¨';
    document.getElementById('readtime').textContent = a.readtime ? `èª­äº†ç›®å®‰ ${a.readtime}åˆ†` : '';

    const $cover = document.getElementById('cover');
    const $img = document.getElementById('cover-img');
    if(a.cover){
      $img.src = a.cover; $img.alt = a.title ? `${a.title} ã®ã‚«ãƒãƒ¼ç”»åƒ` : 'ã‚«ãƒãƒ¼ç”»åƒ';
      $cover.hidden = false; $cover.setAttribute('aria-hidden','false');
    }else{
      $cover.hidden = true;  $cover.setAttribute('aria-hidden','true');
    }
    document.getElementById('body').innerHTML = a.html || '<p>æœ¬æ–‡ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';

    const can = document.getElementById('canonical');
    const href = `https://babyanimals.pages.dev/news/${encodeURIComponent(a.slug || '')}`;
    can.setAttribute('href', a.canonical || href);
  }
  (async function init(){
    const slug = getSlug();
    if(!slug){
      document.getElementById('body').textContent = 'è¨˜äº‹ã®æŒ‡å®šï¼ˆslugï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚';
      return;
    }
    try{
      const a = await fetchArticleBySlug(slug);
      render(a);
    }catch(e){
      console.error(e);
      document.getElementById('body').innerHTML =
        '<div class="hero__error" role="alert">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>';
    }
  })();
})();
</script>
</body>
</html>
